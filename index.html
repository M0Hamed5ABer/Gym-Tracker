<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>Gym Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: Arial;
        text-align: center;
        direction: rtl;
        background: #bdf7ff;
        color: #000;
        padding: 20px;
        transition: background 0.3s, color 0.3s;
      }
      .dark-mode {
        background: #121212;
        color: #fff;
      }
      .dark-mode .exercise {
        background: #1e1e1e;
        box-shadow: 0 0 10px #555;
        color: #fff;
      }
      .dark-mode button {
        background-color: #333;
        color: #fff;
      }
      .dark-mode button:hover {
        background-color: #fff;
        color: #000;
      }
      .dark-mode input[type="number"] {
        background-color: #333;
        color: #fff;
        border: 1px solid #777;
      }
      .main-title {
        padding-left: 40px;
      }
      #tracker {
        display: flex;
        flex-direction: column;
      }
      .section {
        margin: 15px 0;
      }
      .exercise {
        background: #fff;
        margin: 10px auto;
        padding: 10px;
        width: 100%;
        max-width: 400px;
        border-radius: 8px;
        box-shadow: 0 0 10px #ccc;
      }
      .controls {
        margin-top: 10px;
      }
      canvas {
        max-width: 90%;
        margin-top: 30px;
        transition: transform 0.3s ease;
      }
      button {
        padding: 8px 16px;
        margin: 8px 5px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        color: #000;
        background-color: #eee;
        border: none;
        border-radius: 6px;
      }
      button:hover {
        color: #fff;
        background-color: #000;
      }
      input[type="number"] {
        width: 100px;
        height: 40px;
        text-align: center;
      }
      #clearChart {
        background: red;
        color: white;
      }
      #toggleDarkMode {
        position: fixed;
        top: 15px;
        left: 15px;
        z-index: 999;
      }
    </style>
  </head>
  <body>
    <button id="toggleDarkMode">ğŸŒ™</button>
    <h1 class="main-title">GYM TRACKER</h1>
    <div id="tracker"></div>

    <button id="saveData">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
    <button id="expandChart">ğŸ–¼ï¸ ØªÙƒØ¨ÙŠØ±/ØªØµØºÙŠØ± Ø§Ù„Ù…Ø®Ø·Ø·</button>
    <canvas id="progressChart"></canvas>
    <button id="clearChart">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù…Ø®Ø·Ø·</button>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†
      const exercises = {
        "ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¯ÙØ¹": ["Ø¯ÙØ¹ Ø§Ø±Ø¶ÙŠ", "Ø¯ÙØ¹ Ø¹Ø§Ù„ÙŠ", "ÙØ±Ø§Ø´Ø©", "ÙƒØªÙ Ø¬Ø§Ù†Ø¨ÙŠ", "ÙƒØªÙ Ø¹Ù„ÙˆÙŠ", "Ø¨Ø§ÙŠ Ø¹Ù„ÙŠ Ø§Ù„Ø¬Ù‡Ø§Ø²"],
        "ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø³Ø­Ø¨": ["Ø³Ø­Ø¨ Ø£Ø±Ø¶ÙŠ", "Ø³Ø­Ø¨ Ø¹Ø§Ù„ÙŠ", "Ø¨Ø§ÙŠØ³Ø¨Ø³"],
        "ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø±Ø¬Ù„": ["Ø³ÙƒÙˆØ§Øª", "Ù„Ø§Ù†Ø¬", "Ø³Ù…ÙŠ Ø¯ÙŠØ¯Ù„ÙØª"]
      };

      const trackerDiv = document.getElementById("tracker");
      const saveBtn = document.getElementById("saveData");
      const chartCanvas = document.getElementById("progressChart");
      const chartCtx = chartCanvas.getContext("2d");
      let chart;

      let progressData = JSON.parse(localStorage.getItem("progressData")) || {};

      function createExerciseSection() {
        for (let group in exercises) {
          const section = document.createElement("div");
          section.className = "section";
          section.innerHTML = `<h2>${group}</h2>`;
          exercises[group].forEach((exercise) => {
            const container = document.createElement("div");
            container.className = "exercise";
            container.innerHTML = `
              <p>${exercise}</p>
              <div class="controls">
                <button onclick="changeWeight('${exercise}', -2.5)">â¬‡</button>
                <input id="${exercise}-weight" type="number" value="${getLastWeight(exercise)}" readonly>
                <button onclick="changeWeight('${exercise}', 2.5)">â¬†</button>
              </div>
            `;
            section.appendChild(container);
          });
          trackerDiv.appendChild(section);
        }
      }

      const tempWeights = {};

      function getLastWeight(ex) {
        return progressData[ex]?.slice(-1)[0]?.weight || 0;
      }

      function changeWeight(ex, delta) {
        tempWeights[ex] = (tempWeights[ex] ?? getLastWeight(ex)) + delta;
        tempWeights[ex] = Math.max(0, tempWeights[ex]); // Ù„Ø§ Ø£ÙˆØ²Ø§Ù† Ø³Ø§Ù„Ø¨Ø©
        document.getElementById(`${ex}-weight`).value = tempWeights[ex];
      }

      saveBtn.addEventListener("click", () => {
        const today = new Date().toLocaleDateString("ar-EG");
        for (let ex in tempWeights) {
          if (!progressData[ex]) progressData[ex] = [];
          progressData[ex].push({ weight: tempWeights[ex], date: today });
        }
        localStorage.setItem("progressData", JSON.stringify(progressData));
        drawChart();
        alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
      });

      function drawChart() {
        if (chart) chart.destroy();
        const datasets = [];

        let labels = [];
        for (let ex in progressData) {
          const data = progressData[ex];
          const weights = data.map(d => d.weight);
          const dates = data.map(d => d.date);
          labels = [...new Set([...labels, ...dates])]; // Ø¯Ù…Ø¬ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±

          datasets.push({
            label: ex,
            data: weights,
            borderColor: '#' + Math.floor(Math.random()*16777215).toString(16),
            fill: false,
            tension: 0.3
          });
        }

        chart = new Chart(chartCtx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: datasets
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'bottom' },
              title: { display: true, text: 'ØªØ·ÙˆØ± Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®' }
            }
          }
        });
      }

      document.getElementById("clearChart").addEventListener("click", () => {
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
          localStorage.removeItem("progressData");
          progressData = {};
          if (chart) chart.destroy();
          document.querySelectorAll("input[type='number']").forEach(input => input.value = 0);
        }
      });

      document.getElementById("expandChart").addEventListener("click", () => {
        chartCanvas.style.transform = chartCanvas.style.transform === "scale(1.5)" ? "scale(1)" : "scale(1.5)";
      });

      // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
      const toggleDarkBtn = document.getElementById("toggleDarkMode");

      function applyTheme() {
        const mode = localStorage.getItem("theme");
        if (mode === "dark") {
          document.body.classList.add("dark-mode");
        } else {
          document.body.classList.remove("dark-mode");
        }
      }

      toggleDarkBtn.addEventListener("click", () => {
        document.body.classList.toggle("dark-mode");
        const mode = document.body.classList.contains("dark-mode") ? "dark" : "light";
        localStorage.setItem("theme", mode);
      });

      applyTheme();
      createExerciseSection();
    </script>
  </body>
</html>
