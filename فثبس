<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>Gym Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: Arial;
        text-align: center;
        direction: rtl;
        background: #bdf7ff;
        color: #000;
        padding: 20px;
        transition: background 0.3s, color 0.3s;
      }
      .dark-mode {
        background: #121212;
        color: #fff;
      }
      .dark-mode .exercise {
        background: #1e1e1e;
        box-shadow: 0 0 10px #555;
        color: #fff;
      }
      .dark-mode button {
        background-color: #333;
        color: #fff;
      }
      .dark-mode button:hover {
        background-color: #fff;
        color: #000;
      }
      .dark-mode input[type="number"] {
        background-color: #333;
        color: #fff;
        border: 1px solid #777;
      }
      .main-title {
        padding-left: 40px;
      }
      #exerciseTypes {
        margin: 20px 0;
      }
      #exerciseTypes button {
        margin: 5px;
        padding: 10px 20px;
        font-weight: bold;
        border-radius: 6px;
        cursor: pointer;
        background: #333;
        color: #fff;
      }
      #exerciseTypes button:hover {
        background: #fff;
        color: #000;
      }
      #addExerciseSection {
        position: relative;
      }
      #suggestions {
        left: 40px; /* Ø¶Ø¨Ø· Ù‡Ø°Ø§ Ø­Ø³Ø¨ ØªØµÙ…ÙŠÙ…Ùƒ */
        top: 42px;
      }

      #tracker {
        display: flex;
        flex-direction: column;
      }
      .section {
        margin: 15px 0;
      }
      .exercise {
        background: #fff;
        margin: 10px auto;
        padding: 10px;
        width: 100%;
        max-width: 400px;
        border-radius: 8px;
        box-shadow: 0 0 10px #ccc;
      }
      .controls {
        margin-top: 10px;
      }
      canvas {
        max-width: 90%;
        margin-top: 30px;
        transition: transform 0.3s ease;
      }
      button {
        padding: 8px 32px;
        margin: 8px 5px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        background-color: #eee;
        border: none;
        border-radius: 6px;
      }
      button:hover {
        color: #fff;
        background-color: #000;
      }
      input[type="number"] {
        width: 100px;
        height: 40px;
        text-align: center;
      }
      #clearChart {
        background: red;
        color: white;
      }
      #toggleDarkMode {
        position: fixed;
        top: 15px;
        left: 15px;
        z-index: 999;
      }
    </style>
  </head>
  <body>
    <button id="toggleDarkMode">ğŸŒ™</button>
    <h1 class="main-title">GYM TRACKER</h1>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† -->
    <div id="exerciseTypes">
      <button onclick="showExercises('ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¯ÙØ¹')">ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¯ÙØ¹</button>
      <button onclick="showExercises('ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø³Ø­Ø¨')">ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø³Ø­Ø¨</button>
      <button onclick="showExercises('ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø±Ø¬Ù„')">ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø±Ø¬Ù„</button>
      <button
        id="showAllBtn"
        onclick="showAllExercises()"
        style="display: none"
      >
        Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
      </button>
    </div>
    <div id="addExerciseSection" style="margin: 20px auto; max-width: 400px">
      <select id="exerciseGroup" style="padding: 8px; font-size: 1rem">
        <option value="ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¯ÙØ¹">ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¯ÙØ¹</option>
        <option value="ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø³Ø­Ø¨">ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø³Ø­Ø¨</option>
        <option value="ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø±Ø¬Ù„">ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø±Ø¬Ù„</option>
      </select>
      <input
        type="text"
        id="newExerciseName"
        placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ†"
        style="padding: 8px; width: 60%; font-size: 1rem"
        autocomplete="off"
      />
      <button onclick="addNewExercise()">â• Ø¥Ø¶Ø§ÙØ© ØªÙ…Ø±ÙŠÙ†</button>
      <div
        id="suggestions"
        style="
          border: 1px solid #ccc;
          background: #fff;
          max-height: 150px;
          overflow-y: auto;
          display: none;
          position: absolute;
          z-index: 1000;
          width: 60%;
          margin: 0 auto;
        "
      ></div>
    </div>

    <div id="tracker"></div>

    <button id="saveData">ğŸ’¾ Ø­ÙØ¸</button>
    <button id="expandChart">ğŸ–¼ï¸ ØªÙƒØ¨ÙŠØ±/ØªØµØºÙŠØ±</button>
    <canvas id="progressChart"></canvas>
    <button id="clearChart">ğŸ—‘ï¸ Ù…Ø³Ø­</button>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Ù‚Ø§Ø¦Ù…Ø© ØªÙ…Ø§Ø±ÙŠÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙƒØ§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
      const defaultExercises = [
        "Ø¶ØºØ· ØµØ¯Ø±",
        "Ø³Ø­Ø¨ Ø®Ù„ÙÙŠ",
        "Ø³ÙƒÙˆØ§Øª",
        "Ø¶ØºØ· ÙƒØªÙ",
        "ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø¨Ø§ÙŠ",
        "ØªÙ…Ø±ÙŠÙ† Ø§Ù„ØªØ±Ø§ÙŠ",
        "Ø±ÙØ¹Ø© Ù…ÙŠØªØ©",
        "Ø·Ø¹Ù†Ø§Øª Ø§Ù„Ø±Ø¬Ù„",
        "ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ",
        "Ø¶ØºØ· Ø£Ø±Ø¬Ù„",
      ];

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ù…Ù† localStorage Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
      function loadExercises() {
        const saved = localStorage.getItem("exercises");
        if (saved) {
          return JSON.parse(saved);
        } else {
          return {
            "ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¯ÙØ¹": [],
            "ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø³Ø­Ø¨": [],
            "ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø±Ø¬Ù„": [],
          };
        }
      }

      // Ø­ÙØ¸ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† ÙÙŠ localStorage
      function saveExercises() {
        localStorage.setItem("exercises", JSON.stringify(exercises));
      }

      const newExerciseInput = document.getElementById("newExerciseName");
      const suggestionsBox = document.getElementById("suggestions");

      // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† ÙÙŠ Ù…ØµÙÙˆÙØ© ÙˆØ§Ø­Ø¯Ø© (Ù„Ø§ ØªØªÙƒØ±Ø±)
      function getAllExerciseNames() {
        const all = [];
        for (const group in exercises) {
          all.push(...exercises[group]);
        }
        all.push(...defaultExercises);
        return [...new Set(all)];
      }

      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
      newExerciseInput.addEventListener("input", () => {
        const val = newExerciseInput.value.trim();
        suggestionsBox.innerHTML = "";
        if (!val) {
          suggestionsBox.style.display = "none";
          return;
        }
        const allNames = getAllExerciseNames();
        const filtered = allNames.filter((name) =>
          name.toLowerCase().includes(val.toLowerCase())
        );

        if (filtered.length === 0) {
          suggestionsBox.style.display = "none";
          return;
        }
        filtered.forEach((name) => {
          const div = document.createElement("div");
          div.textContent = name;
          div.style.padding = "6px";
          div.style.cursor = "pointer";
          div.addEventListener("click", () => {
            newExerciseInput.value = name;
            suggestionsBox.style.display = "none";
          });
          div.addEventListener("mouseenter", () => {
            div.style.backgroundColor = "#ddd";
          });
          div.addEventListener("mouseleave", () => {
            div.style.backgroundColor = "#fff";
          });
          suggestionsBox.appendChild(div);
        });
        suggestionsBox.style.display = "block";
      });

      // Ø¥Ø®ÙØ§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø®Ø§Ù†Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø£Ùˆ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
      document.addEventListener("click", (e) => {
        if (
          e.target !== newExerciseInput &&
          e.target.parentNode !== suggestionsBox
        ) {
          suggestionsBox.style.display = "none";
        }
      });

      let exercises = loadExercises();

      const trackerDiv = document.getElementById("tracker");
      const saveBtn = document.getElementById("saveData");
      const chartCanvas = document.getElementById("progressChart");
      const chartCtx = chartCanvas.getContext("2d");
      const showAllBtn = document.getElementById("showAllBtn");
      let chart;

      let progressData = JSON.parse(localStorage.getItem("progressData")) || {};
      const tempWeights = {};
      const sectionsMap = {};

      function getLastWeight(ex) {
        return progressData[ex]?.slice(-1)[0]?.weight || 0;
      }

      function createExerciseSection() {
        trackerDiv.innerHTML = ""; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø³Ù… Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ© (Ù…Ù‡Ù… Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡)

        for (let group in exercises) {
          const section = document.createElement("div");
          section.className = "section";
          section.dataset.group = group;
          section.innerHTML = `<h2>${group}</h2>`;

          exercises[group].forEach((exercise) => {
            const container = document.createElement("div");
            container.className = "exercise";
            container.innerHTML = `
          <p>${exercise}</p>
          <div class="controls">
            <button onclick="changeWeight('${exercise}', 2.5)">â¬†</button>
            <input id="${exercise}-weight" type="number" value="${getLastWeight(
              exercise
            )}" readonly>
            <button onclick="changeWeight('${exercise}', -2.5)">â¬‡</button>
            <button onclick="deleteExercise('${group}', '${exercise}')">ğŸ—‘ï¸</button>
          </div>
        `;
            section.appendChild(container);
          });

          trackerDiv.appendChild(section);
          sectionsMap[group] = section;
        }
      }

      function showExercises(group) {
        for (let g in sectionsMap) {
          sectionsMap[g].style.display = g === group ? "block" : "none";
        }
        showAllBtn.style.display = "inline-block"; // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
      }

      function showAllExercises() {
        for (let g in sectionsMap) {
          sectionsMap[g].style.display = "block";
        }
        showAllBtn.style.display = "none"; // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
      }

      function changeWeight(ex, delta) {
        tempWeights[ex] = (tempWeights[ex] ?? getLastWeight(ex)) + delta;
        tempWeights[ex] = Math.max(0, tempWeights[ex]);
        document.getElementById(`${ex}-weight`).value = tempWeights[ex];
      }

      saveBtn.addEventListener("click", () => {
        const today = new Date().toLocaleDateString("ar-EG");
        for (let ex in tempWeights) {
          if (!progressData[ex]) progressData[ex] = [];
          progressData[ex].push({ weight: tempWeights[ex], date: today });
        }
        localStorage.setItem("progressData", JSON.stringify(progressData));
        drawChart();
        alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
      });

      function drawChart() {
        if (chart) chart.destroy();
        const datasets = [];
        let labels = [];

        for (let ex in progressData) {
          const data = progressData[ex];
          const weights = data.map((d) => d.weight);
          const dates = data.map((d) => d.date);
          labels = [...new Set([...labels, ...dates])];

          datasets.push({
            label: ex,
            data: weights,
            borderColor:
              "#" + Math.floor(Math.random() * 16777215).toString(16),
            fill: false,
            tension: 0.3,
          });
        }

        chart = new Chart(chartCtx, {
          type: "line",
          data: {
            labels: labels,
            datasets: datasets,
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: "bottom" },
              title: { display: true, text: "ØªØ·ÙˆØ± Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®" },
            },
          },
        });
      }

      document.getElementById("clearChart").addEventListener("click", () => {
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
          localStorage.removeItem("progressData");
          progressData = {};
          if (chart) chart.destroy();
          document
            .querySelectorAll("input[type='number']")
            .forEach((input) => (input.value = 0));
        }
      });

      document.getElementById("expandChart").addEventListener("click", () => {
        chartCanvas.style.transform =
          chartCanvas.style.transform === "scale(1.5)"
            ? "scale(1)"
            : "scale(1.5)";
      });

      const toggleDarkBtn = document.getElementById("toggleDarkMode");

      function applyTheme() {
        const mode = localStorage.getItem("theme");
        if (mode === "dark") {
          document.body.classList.add("dark-mode");
        } else {
          document.body.classList.remove("dark-mode");
        }
      }

      toggleDarkBtn.addEventListener("click", () => {
        document.body.classList.toggle("dark-mode");
        const mode = document.body.classList.contains("dark-mode")
          ? "dark"
          : "light";
        localStorage.setItem("theme", mode);
      });

      function addNewExercise() {
        let name = document.getElementById("newExerciseName").value.trim();
        name = name.replace(/\s+/g, " "); // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙØ±Ø§ØºØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©

        if (name.length === 0) {
          alert("â— Ø§Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ† ØºÙŠØ± ØµØ§Ù„Ø­");
          return;
        }

        const group = document.getElementById("exerciseGroup").value;

        if (
          exercises[group].some((ex) => ex.toLowerCase() === name.toLowerCase())
        ) {
          alert("âš ï¸ Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§");
          return;
        }

        exercises[group].push(name);
        saveExercises();

        const section = sectionsMap[group];
        const container = document.createElement("div");
        container.className = "exercise";
        container.innerHTML = `
      <p>${name}</p>
      <div class="controls">
        <button onclick="changeWeight('${name}', 2.5)">â¬†</button>
        <input id="${name}-weight" type="number" value="0" readonly>
        <button onclick="changeWeight('${name}', -2.5)">â¬‡</button>
        <button onclick="deleteExercise('${group}', '${name}')">ğŸ—‘ï¸</button>
      </div>
    `;
        section.appendChild(container);

        showAllExercises();
        document.getElementById("newExerciseName").value = "";
      }

      function deleteExercise(group, name) {
        if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„ØªÙ…Ø±ÙŠÙ† "${name}"ØŸ`)) {
          exercises[group] = exercises[group].filter((ex) => ex !== name);
          saveExercises();

          const input = document.getElementById(`${name}-weight`);
          if (input) input.closest(".exercise").remove();

          delete progressData[name];
          localStorage.setItem("progressData", JSON.stringify(progressData));
        }
      }

      applyTheme();
      createExerciseSection();
      showAllExercises(); // Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    </script>
  </body>
</html>
